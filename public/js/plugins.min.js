!function(t){"use strict";var e=function(i,n,s){s&&(s.stopPropagation(),s.preventDefault()),this.$element=t(i),this.$newElement=null,this.$button=null,this.$menu=null,this.options=t.extend({},t.fn.selectpicker.defaults,this.$element.data(),"object"==typeof n&&n),null==this.options.title&&(this.options.title=this.$element.attr("title")),this.val=e.prototype.val,this.render=e.prototype.render,this.refresh=e.prototype.refresh,this.setStyle=e.prototype.setStyle,this.selectAll=e.prototype.selectAll,this.deselectAll=e.prototype.deselectAll,this.init()};e.prototype={constructor:e,init:function(){this.$element.hide(),this.multiple=this.$element.prop("multiple");var e=this.$element.attr("id");if(this.$newElement=this.createView(),this.$element.after(this.$newElement),this.$menu=this.$newElement.find("> .dropdown-menu"),this.$button=this.$newElement.find("> button"),void 0!==e){var i=this;this.$button.attr("data-id",e),t('label[for="'+e+'"]').click(function(){i.$button.focus()})}this.multiple&&this.$newElement.addClass("show-tick"),this.checkDisabled(),this.checkTabIndex(),this.clickListener(),this.render(),this.liHeight(),this.setWidth(),this.setStyle(),this.options.container&&this.selectPosition()},createDropdown:function(){var e="<div class='btn-group bootstrap-select'><button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'><div class='filter-option pull-left'></div>&nbsp;<div class='caret'></div></button><div class='dropdown-menu open'><ul class='dropdown-menu inner' role='menu'></ul></div></div>";return t(e)},createView:function(){var t=this.createDropdown(),e=this.createLi();return t.find("ul").append(e),t},reloadLi:function(){this.destroyLi();var t=this.createLi();this.$newElement.find("ul").append(t)},destroyLi:function(){this.$newElement.find("li").remove()},createLi:function(){var e=this,i=[],n="";return this.$element.find("option").each(function(){var n=t(this),s=n.attr("class")||"",o=n.attr("style")||"",l=n.data("content")?n.data("content"):n.html(),a=void 0!==n.data("subtext")?'<small class="muted">'+n.data("subtext")+"</small>":"",d=void 0!==n.data("icon")?'<i class="'+n.data("icon")+'"></i> ':"";if(""!==d&&(n.is(":disabled")||n.parent().is(":disabled"))&&(d="<span>"+d+"</span>"),n.data("content")||(l=d+'<span class="text">'+l+a+"</span>"),e.options.hideDisabled&&(n.is(":disabled")||n.parent().is(":disabled")))i.push('<a style="min-height: 0; padding: 0"></a>');else if(n.parent().is("optgroup")&&1!=n.data("divider"))if(0==n.index()){var r=n.parent().attr("label"),c=void 0!==n.parent().data("subtext")?'<small class="muted">'+n.parent().data("subtext")+"</small>":"",h=n.parent().data("icon")?'<i class="'+n.parent().data("icon")+'"></i> ':"";r=h+'<span class="text">'+r+c+"</span>",0!=n[0].index?i.push('<div class="div-contain"><div class="divider"></div></div><dt>'+r+"</dt>"+e.createA(l,"opt "+s,o)):i.push("<dt>"+r+"</dt>"+e.createA(l,"opt "+s,o))}else i.push(e.createA(l,"opt "+s,o));else 1==n.data("divider")?i.push('<div class="div-contain"><div class="divider"></div></div>'):1==t(this).data("hidden")?i.push(""):i.push(e.createA(l,s,o))}),t.each(i,function(t,e){n+="<li rel="+t+">"+e+"</li>"}),this.multiple||0!=this.$element.find("option:selected").length||e.options.title||this.$element.find("option").eq(0).prop("selected",!0).attr("selected","selected"),t(n)},createA:function(t,e,i){return'<a tabindex="0" class="'+e+'" style="'+i+'">'+t+'<i class="icon-ok check-mark"></i>'+"</a>"},render:function(){var e=this;this.$element.find("option").each(function(i){e.setDisabled(i,t(this).is(":disabled")||t(this).parent().is(":disabled")),e.setSelected(i,t(this).is(":selected"))});var i=this.$element.find("option:selected").map(function(){var i,n=t(this),s=n.data("icon")&&e.options.showIcon?'<i class="'+n.data("icon")+'"></i> ':"";return i=e.options.showSubtext&&n.attr("data-subtext")&&!e.multiple?' <small class="muted">'+n.data("subtext")+"</small>":"",n.data("content")&&e.options.showContent?n.data("content"):void 0!=n.attr("title")?n.attr("title"):s+n.html()+i}).toArray(),n=this.multiple?i.join(", "):i[0];if(e.multiple&&e.options.selectedTextFormat.indexOf("count")>-1){var s=e.options.selectedTextFormat.split(">"),o=this.options.hideDisabled?":not([disabled])":"";(s.length>1&&i.length>s[1]||1==s.length&&i.length>=2)&&(n=e.options.countSelectedText.replace("{0}",i.length).replace("{1}",this.$element.find('option:not([data-divider="true"]):not([data-hidden="true"])'+o).length))}n||(n=void 0!=e.options.title?e.options.title:e.options.noneSelectedText),e.$newElement.find(".filter-option").html(n)},setStyle:function(t,e){this.$element.attr("class")&&this.$newElement.addClass(this.$element.attr("class").replace(/selectpicker|mobile-device/gi,""));var i=t?t:this.options.style;"add"==e?this.$button.addClass(i):(this.$button.removeClass(this.options.style),this.$button.addClass(i))},liHeight:function(){var t=this.$newElement.clone();t.appendTo("body");var e=t.addClass("open").find(".dropdown-menu li > a").outerHeight();t.remove(),this.$newElement.data("liHeight",e)},setSize:function(){var e,i=this,n=this.$menu,s=n.find(".inner"),o=(s.find("li > a"),this.$newElement.outerHeight()),l=this.$newElement.data("liHeight"),a=n.find("li .divider").outerHeight(!0),d=parseInt(n.css("padding-top"))+parseInt(n.css("padding-bottom"))+parseInt(n.css("border-top-width"))+parseInt(n.css("border-bottom-width")),r=this.options.hideDisabled?":not(.disabled)":"";if("auto"==this.options.size){var c=function(){var a,r=i.$newElement.offset().top,c=r-t(window).scrollTop(),h=t(window).height(),p=d+parseInt(n.css("margin-top"))+parseInt(n.css("margin-bottom"))+2,u=h-c-o-p;e=u,i.$newElement.hasClass("dropup")&&(e=c-p),a=n.find("li").length+n.find("dt").length>3?3*l+p-2:0,n.css({"max-height":e+"px",overflow:"hidden","min-height":a+"px"}),s.css({"max-height":e-d+"px","overflow-y":"auto"})};c(),t(window).resize(c),t(window).scroll(c)}else if(this.options.size&&"auto"!=this.options.size&&n.find("li"+r).length>this.options.size){var h=n.find("li"+r+" > *").filter(":not(.div-contain)").slice(0,this.options.size).last().parent().index(),p=n.find("li").slice(0,h+1).find(".div-contain").length;e=l*this.options.size+p*a+d,n.css({"max-height":e+"px",overflow:"hidden"}),s.css({"max-height":e-d+"px","overflow-y":"auto"})}},setWidth:function(){if("auto"==this.options.width){this.$menu.css("min-width","0");var t=this.$newElement.clone().appendTo("body"),e=t.find("> .dropdown-menu").css("width");t.remove(),this.$newElement.css("width",e)}else this.options.width&&this.$newElement.css("width",this.options.width)},selectPosition:function(){var e,i,n=this,s="<div />",o=t(s),l=function(t){o.addClass(t.attr("class").replace(/open/gi,"")),e=t.offset(),i=t[0].offsetHeight,o.css({top:e.top+i,left:e.left,width:t[0].offsetWidth,position:"absolute"})};this.$newElement.on("click",function(){return l(t(this)),o.toggleClass("open"),o.append(n.$menu),o.appendTo(n.options.container),!1}),t(window).resize(function(){l(n.$newElement)}),t(window).scroll(function(){l(n.$newElement)}),t("html").on("click",function(){o.removeClass("open")})},mobile:function(){this.$element.addClass("mobile-device").appendTo(this.$newElement),this.options.container&&this.$menu.hide()},refresh:function(){this.reloadLi(),this.render(),this.setWidth(),this.setStyle(),this.checkDisabled()},setSelected:function(t,e){this.$menu.find("li").eq(t).toggleClass("selected",e)},setDisabled:function(t,e){e?this.$menu.find("li").eq(t).addClass("disabled").find("a").attr("href","#").attr("tabindex",-1):this.$menu.find("li").eq(t).removeClass("disabled").find("a").removeAttr("href").attr("tabindex",0)},isDisabled:function(){return this.$element.is(":disabled")},checkDisabled:function(){var t=this;this.isDisabled()?(this.$button.addClass("disabled"),this.$button.attr("tabindex","-1")):this.$button.hasClass("disabled")&&(this.$button.removeClass("disabled"),this.$button.removeAttr("tabindex")),this.$button.click(function(){return!t.isDisabled()})},checkTabIndex:function(){if(this.$element.is("[tabindex]")){var t=this.$element.attr("tabindex");this.$button.attr("tabindex",t)}},clickListener:function(){var e=this;t("body").on("touchstart.dropdown",".dropdown-menu",function(t){t.stopPropagation()}),this.$newElement.on("click",function(){e.setSize()}),this.$menu.on("click","li a",function(i){var n=t(this).parent().index(),s=(t(this).parent(),e.$element.val());if(e.multiple&&i.stopPropagation(),i.preventDefault(),!e.isDisabled()&&!t(this).parent().hasClass("disabled")){var o=e.$element.find("option"),l=o.eq(n);if(e.multiple){var a=l.prop("selected");l.prop("selected",!a)}else o.prop("selected",!1),l.prop("selected",!0);e.$button.focus(),s!=e.$element.val()&&e.$element.change()}}),this.$menu.on("click","li.disabled a, li dt, li .div-contain",function(t){t.preventDefault(),t.stopPropagation(),e.$button.focus()}),this.$element.change(this.render.bind(this))},val:function(t){return void 0!=t?(this.$element.val(t),this.$element.change(),this.$element):this.$element.val()},selectAll:function(){this.$element.find("option").prop("selected",!0).attr("selected","selected"),this.render()},deselectAll:function(){this.$element.find("option").prop("selected",!1).removeAttr("selected"),this.render()},keydown:function(e){var i,n,s,o,l,a,d,r,c;if(i=t(this),s=i.parent(),n=t("[role=menu] li:not(.divider):visible a",s),n.length){if(/(38|40)/.test(e.keyCode))o=n.index(n.filter(":focus")),a=n.parent(":not(.disabled)").first().index(),d=n.parent(":not(.disabled)").last().index(),l=n.eq(o).parent().nextAll(":not(.disabled)").eq(0).index(),r=n.eq(o).parent().prevAll(":not(.disabled)").eq(0).index(),c=n.eq(l).parent().prevAll(":not(.disabled)").eq(0).index(),38==e.keyCode&&(o!=c&&o>r&&(o=r),a>o&&(o=a)),40==e.keyCode&&(o!=c&&l>o&&(o=l),o>d&&(o=d)),n.eq(o).focus();else{var h={48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"},p=[];n.each(function(){t(this).parent().is(":not(.disabled)")&&t.trim(t(this).text().toLowerCase()).substring(0,1)==h[e.keyCode]&&p.push(t(this).parent().index())});var u=t(document).data("keycount");u++,t(document).data("keycount",u);var f=t.trim(t(":focus").text().toLowerCase()).substring(0,1);f!=h[e.keyCode]?(u=1,t(document).data("keycount",u)):u>=p.length&&t(document).data("keycount",0),n.eq(p[u-1]).focus()}/(13)/.test(e.keyCode)&&(t(":focus").click(),s.addClass("open"),t(document).data("keycount",0))}},hide:function(){this.$newElement.hide()},show:function(){this.$newElement.show()},destroy:function(){this.$newElement.remove(),this.$element.remove()}},t.fn.selectpicker=function(i,n){var s,o=arguments,l=this.each(function(){if(t(this).is("select")){var l=t(this),a=l.data("selectpicker"),d="object"==typeof i&&i;if(a){if(d)for(var r in d)a.options[r]=d[r]}else l.data("selectpicker",a=new e(this,d,n));if("string"==typeof i){var c=i;a[c]instanceof Function?([].shift.apply(o),s=a[c].apply(a,o)):s=a.options[c]}}});return void 0!=s?s:l},t.fn.selectpicker.defaults={style:null,size:"auto",title:null,selectedTextFormat:"values",noneSelectedText:"Nothing selected",countSelectedText:"{0} of {1} selected",width:null,container:!1,hideDisabled:!1,showSubtext:!1,showIcon:!0,showContent:!0},t(document).data("keycount",0).on("keydown","[data-toggle=dropdown], [role=menu]",e.prototype.keydown)}(window.jQuery);
